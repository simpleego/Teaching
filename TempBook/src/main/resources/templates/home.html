<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book Store</title>
    <link rel="stylesheet" href="/css/common.css">
    <style>
        button.active {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div id="container">
    <!-- 프래그먼트 삽입 -->
    <header th:replace="common/header :: header"></header>
    <main>
        <div class="right" th:if="${session.loginUser == null}">
            <a href="/user/add">회원가입</a>
            <a href="/user/login">로그인</a>
        </div>
        <div class="right" th:if="${session.loginUser != null}">
            <p><b th:text="${session.loginUser.userName}"></b>님, 환영합니다.</p>
            <div>
                <a th:href="@{/user/edit/{id}(id=${session.loginUser.custId})}">회원정보 수정</a>
                <a href="/order/history">주문 내역</a>
                <form action="/user/logout">
                    <button type="submit">로그아웃</button>
                </form>
            </div>
        </div>

        <div id="bookContent">
            <h1>도서 검색</h1>
            <form method="get" th:action="@{/search}">
                <input type="text" name="bookname" placeholder="도서 이름">
                <input type="text" name="publisher" placeholder="출판사" th:value="${publisher}">
                <input type="text" name="year" placeholder="출판년">

                <select name="sort">
                    <option value="bookname" th:selected="${sort == 'bookname'}">도서명</option>
                    <option value="year" th:selected="${sort == 'year'}">출판년도</option>
                    <option value="price" th:selected="${sort == 'price'}">가격</option>
                </select>

                <button type="submit">검색</button>
            </form>
            <h2 class="center"> 구매 가능 도서 목록 </h2>
            <table>
                <thead>
                <tr>
                    <th> 순 번</th>
                    <th> 책 제목</th>
                    <th> 출 판 사</th>
                    <th> 가 격</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="book, stat : ${books}">
                    <td>
                        <img th:if="${book.storedFileName}" th:src="@{/images/{filename}(filename=${book.storedFileName})}" alt="도서 이미지" width="100">
                    </td>
                    <td>
                        <a th:href="@{/book/detail/{id}(id=${book.bookid})}" th:text="${book.bookname}"></a>
                    </td>
                    <td th:text="${book.publisher}"></td>
                    <td th:text="${#numbers.formatDecimal(book.price, 0, 'COMMA', 0, 'POINT')}"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div>
            <!-- 첫 페이지 버튼 -->
            <span th:if="${currentPage > 1}">
                <a th:href="@{/search(bookname=${bookname}, publisher=${publisher}, year=${year}, sort=${sort}, page=1)}">
                    <button>⏮ 첫 페이지</button>
                </a>
            </span>

            <!-- 이전 페이지 버튼 -->
            <span th:if="${currentPage > 1}">
                <a th:href="@{/search(bookname=${bookname},publisher=${publisher}, year=${year},sort=${sort}, page=${currentPage - 1})}">
                    <button>◀ 이전</button>
                </a>
            </span>

            <!-- 현재 페이지 표시 -->
            <span>페이지 [[${currentPage}]] / [[${totalPages}]]</span>
<!--            <span th:each="i : ${#numbers.sequence(1, totalPages)}">-->
<!--                <a th:href="@{/search(publisher=${publisher}, year=${year}, sort=${sort}, page=${i})}">-->
<!--                    <button th:classappend="${i == currentPage} ? 'active' : ''">[[${i}]]</button>-->
<!--                </a>-->
<!--            </span>-->

            <!-- 다음 페이지 버튼 -->
            <span th:if="${currentPage < totalPages}">
                <a th:href="@{/search(bookname=${bookname}, publisher=${publisher}, year=${year}, sort=${sort},page=${currentPage + 1})}">
                    <button>다음 ▶</button>
                </a>
            </span>

            <!-- 마지막 페이지 버튼 -->
            <span th:if="${currentPage < totalPages}">
                <a th:href="@{/search(bookname=${bookname}, publisher=${publisher}, year=${year}, page=${totalPages})}">
                    <button>마지막 페이지 ⏭</button>
                </a>
            </span>
        </div>
    </main>
    <footer th:replace="common/footer :: footer"></footer>
</div>
</body>
</html>
