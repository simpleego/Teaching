파이썬과 **YOLOv8**(Ultralytics)을 활용하여 동영상에서 객체를 탐지하는 코드를 3단계로 나누어 설명해 드릴게요. 이 코드를 실행하기 위해서는 먼저 라이브러리를 설치해야 합니다.

**터미널(CMD)에서 실행:**

```bash
pip install ultralytics opencv-python

```

---

## 1단계: 가장 기본적인 객체 탐지 코드

동영상 파일 대신 **이미지 하나**를 대상으로 모델이 어떻게 작동하는지 확인하는 기초 단계입니다.

```python
from ultralytics import YOLO

# 1. 사전 학습된 모델 로드 (n: nano 버전으로 가장 가볍고 빠름)
model = YOLO('yolov8n.pt') 

# 2. 이미지 객체 탐지 수행
results = model('bus.jpg') # 샘플 이미지 입력

# 3. 결과 확인 및 저장
for r in results:
    r.show() # 화면에 띄우기
    r.save(filename='result.jpg') # 파일로 저장

```

---

## 2단계: 동영상 파일 읽고 실시간 탐지하기

이제 `OpenCV`를 결합하여 동영상을 프레임 단위로 읽어와 분석하는 실전 코드입니다.

```python
import cv2
from ultralytics import YOLO

# 모델 로드
model = YOLO('yolov8n.pt')

# 동영상 파일 열기 (0으로 설정하면 웹캠 사용 가능)
video_path = "input_video.mp4"
cap = cv2.VideoCapture(video_path)

while cap.isOpened():
    success, frame = cap.read() # 프레임 읽기

    if success:
        # 모델을 통한 객체 탐지 (stream=True는 메모리 효율을 위해 권장)
        results = model(frame, stream=True)

        # 결과 시각화 (탐지된 박스가 그려진 프레임 가져오기)
        annotated_frame = next(results).plot()

        # 화면에 출력
        cv2.imshow("YOLOv8 Real-Time Detection", annotated_frame)

        # 'q' 키를 누르면 종료
        if cv2.waitKey(1) & 0xFF == ord("q"):
            break
    else:
        break

cap.release()
cv2.destroyAllWindows()

```

---

## 3단계: 분석된 결과를 새 영상 파일로 저장하기

화면에 보여주는 것뿐만 아니라, 탐지 결과가 포함된 영상을 파일(`.mp4`)로 내보내는 과정입니다.

```python
import cv2
from ultralytics import YOLO

model = YOLO('yolov8n.pt')
cap = cv2.VideoCapture("input_video.mp4")

# 원본 영상의 속성 가져오기 (가로, 세로, FPS)
w, h, fps = (int(cap.get(x)) for x in [cv2.CAP_PROP_FRAME_WIDTH, cv2.CAP_PROP_FRAME_HEIGHT, cv2.CAP_PROP_FPS])

# 저장을 위한 VideoWriter 설정
out = cv2.VideoWriter('output_result.mp4', cv2.VideoWriter_fourcc(*'mp4v'), fps, (w, h))

while cap.isOpened():
    ret, frame = cap.read()
    if not ret:
        break

    # 예측 수행
    results = model(frame)
    res_frame = results[0].plot()

    # 프레임 쓰기
    out.write(res_frame)

cap.release()
out.release()
print("영상 저장이 완료되었습니다.")

```

---

### 💡 코드 핵심 요약

1. **`yolov8n.pt`**: 'n'은 Nano 모델로 속도가 매우 빠릅니다. 더 정확한 탐지가 필요하면 `yolov8s.pt`(Small)나 `yolov8m.pt`(Medium)를 사용하세요.
2. **`results[0].plot()`**: 모델이 찾은 객체의 위치와 이름을 이미지 위에 자동으로 그려주는 아주 편리한 함수입니다.
3. **`cv2.VideoCapture(0)`**: 파일 경로 대신 `0`을 넣으면 노트북에 달린 **웹캠**으로 실시간 탐지가 가능합니다.

**다음 단계로 무엇을 도와드릴까요?**
"특정 객체(예: 사람이나 자동차)만 골라서 탐지하도록 **필터링하는 법**을 알려드릴까요?" 아니면 "사용자의 **개인 데이터를 학습**시키는 방법이 궁금하신가요?"
