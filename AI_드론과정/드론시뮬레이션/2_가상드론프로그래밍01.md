# 2. 가상 드론 기반 영상 관제 시스템: 첫 번째 학습 단계

## **1단계: 가상 드론 시뮬레이션 환경 구축**

### 학습 목표
- 가상 드론 환경 설정 및 기본 제어 이해
- 파이썬을 이용한 드론 제어 인터페이스 작성
- 기본 비행 시뮬레이션 구현

### **1.1 가상 드론 클래스 설계 (첫 번째 실습)**

```python
# virtual_drone.py
class VirtualDrone:
    def __init__(self, drone_id="DRONE_001"):
        # 드론 상태 변수
        self.id = drone_id
        self.position = {"x": 0, "y": 0, "z": 0, "altitude": 0}  # 3D 위치 (z는 고도)
        self.attitude = {"roll": 0, "pitch": 0, "yaw": 0}  # 자세
        self.speed = 0  # m/s
        self.battery = 100  # %
        self.is_flying = False
        self.camera_on = False
        
        # 가상 센서 데이터
        self.gps_position = {"lat": 37.5665, "lon": 126.9780}  # 서울 좌표
        self.velocity = {"vx": 0, "vy": 0, "vz": 0}
        
        print(f"[SYSTEM] 가상 드론 {drone_id} 초기화 완료")
    
    def takeoff(self, target_altitude=10):
        """이륙 메서드"""
        if self.is_flying:
            print(f"[WARNING] 드론 {self.id}은(는) 이미 비행 중입니다.")
            return False
        
        print(f"[ACTION] 드론 {self.id} 이륙 시작...")
        self.is_flying = True
        
        # 고도 상승 시뮬레이션
        for alt in range(0, target_altitude + 1, 2):
            self.position["altitude"] = alt
            self.position["z"] = alt
            print(f"  고도: {alt}m")
            time.sleep(0.1)
        
        print(f"[SUCCESS] 드론이 {target_altitude}m 고도에 도달했습니다.")
        return True
    
    def land(self):
        """착륙 메서드"""
        if not self.is_flying:
            print(f"[WARNING] 드론 {self.id}은(는) 이미 지상에 있습니다.")
            return False
        
        print(f"[ACTION] 드론 {self.id} 착륙 시작...")
        
        # 고도 하강 시뮬레이션
        current_alt = self.position["altitude"]
        for alt in range(current_alt, -1, -2):
            self.position["altitude"] = max(0, alt)
            self.position["z"] = max(0, alt)
            print(f"  고도: {max(0, alt)}m")
            time.sleep(0.1)
        
        self.is_flying = False
        print(f"[SUCCESS] 드론이 안전하게 착륙했습니다.")
        return True
    
    def move_to(self, x, y, z, speed=5):
        """특정 좌표로 이동"""
        if not self.is_flying:
            print(f"[ERROR] 드론 {self.id}은(는) 비행 상태가 아닙니다.")
            return False
        
        print(f"[ACTION] ({self.position['x']}, {self.position['y']}, {self.position['z']}) → ({x}, {y}, {z})")
        
        # 위치 업데이트
        self.position["x"] = x
        self.position["y"] = y
        self.position["z"] = z
        self.position["altitude"] = z
        self.speed = speed
        
        # 배터리 소모
        self.battery = max(0, self.battery - 0.5)
        
        return True
    
    def get_status(self):
        """드론 상태 정보 반환"""
        return {
            "drone_id": self.id,
            "position": self.position,
            "attitude": self.attitude,
            "speed": self.speed,
            "battery": self.battery,
            "is_flying": self.is_flying,
            "camera_on": self.camera_on,
            "gps": self.gps_position
        }
    
    def start_camera(self):
        """가상 카메라 시작"""
        self.camera_on = True
        print(f"[SYSTEM] 드론 {self.id} 카메라 가동 시작")
        return True
    
    def capture_image(self):
        """가상 이미지 캡처"""
        if not self.camera_on:
            print(f"[ERROR] 카메라가 꺼져 있습니다.")
            return None
        
        # 가상 이미지 데이터 생성
        timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
        image_data = {
            "filename": f"drone_{self.id}_{timestamp}.jpg",
            "position": self.position.copy(),
            "timestamp": timestamp,
            "resolution": "1920x1080"
        }
        
        print(f"[CAMERA] 이미지 캡처: {image_data['filename']}")
        return image_data
```

### **1.2 기본 제어 프로그램 작성 (두 번째 실습)**

```python
# drone_control_simulation.py
import time
import datetime
from virtual_drone import VirtualDrone

class DroneControlSimulation:
    def __init__(self):
        self.drone = VirtualDrone()
        self.mission_running = False
        
    def show_menu(self):
        """메뉴 표시"""
        print("\n" + "="*50)
        print("가상 드론 제어 시스템")
        print("="*50)
        print("1. 드론 상태 확인")
        print("2. 이륙")
        print("3. 착륙")
        print("4. 이동 제어")
        print("5. 카메라 제어")
        print("6. 미션 실행")
        print("7. 종료")
        print("="*50)
        
    def check_status(self):
        """드론 상태 확인"""
        status = self.drone.get_status()
        print("\n[드론 상태 정보]")
        print(f"드론 ID: {status['drone_id']}")
        print(f"위치: X={status['position']['x']}, Y={status['position']['y']}, 고도={status['position']['altitude']}m")
        print(f"배터리: {status['battery']}%")
        print(f"비행 상태: {'비행 중' if status['is_flying'] else '지상 대기'}")
        print(f"카메라: {'가동 중' if status['camera_on'] else '정지'}")
        
    def manual_control(self):
        """수동 제어"""
        print("\n[이동 제어]")
        try:
            x = float(input("X 좌표 입력: "))
            y = float(input("Y 좌표 입력: "))
            z = float(input("Z 좌표(고도) 입력: "))
            
            if z < 0:
                print("[ERROR] 고도는 0 이상이어야 합니다.")
                return
            
            self.drone.move_to(x, y, z)
            print(f"[SUCCESS] 지정 위치로 이동 완료")
            
        except ValueError:
            print("[ERROR] 숫자를 입력해주세요.")
    
    def camera_control(self):
        """카메라 제어"""
        print("\n[카메라 제어]")
        print("1. 카메라 켜기")
        print("2. 카메라 끄기")
        print("3. 사진 촬영")
        
        choice = input("선택: ")
        
        if choice == "1":
            self.drone.start_camera()
        elif choice == "2":
            self.drone.camera_on = False
            print("[SYSTEM] 카메라 정지")
        elif choice == "3":
            image = self.drone.capture_image()
            if image:
                print(f"촬영 완료: {image['filename']}")
        else:
            print("[ERROR] 잘못된 선택입니다.")
    
    def auto_mission(self):
        """자동 미션 실행"""
        if not self.drone.is_flying:
            print("[ERROR] 먼저 드론을 이륙시켜주세요.")
            return
        
        print("\n[자동 미션 실행]")
        waypoints = [
            (10, 0, 15),
            (10, 10, 15),
            (0, 10, 15),
            (0, 0, 15)
        ]
        
        self.drone.start_camera()
        
        for i, (x, y, z) in enumerate(waypoints):
            print(f"\n[Waypoint {i+1}/{len(waypoints)}] 이동 중...")
            self.drone.move_to(x, y, z)
            
            # 각 웨이포인트에서 사진 촬영
            image = self.drone.capture_image()
            time.sleep(1)
        
        print("\n[미션 완료] 모든 웨이포인트 방문 완료")
    
    def run(self):
        """시뮬레이션 실행"""
        print("[시스템 시작] 가상 드론 시뮬레이션을 시작합니다.")
        
        while True:
            self.show_menu()
            choice = input("메뉴 선택: ")
            
            if choice == "1":
                self.check_status()
            elif choice == "2":
                self.drone.takeoff()
            elif choice == "3":
                self.drone.land()
            elif choice == "4":
                self.manual_control()
            elif choice == "5":
                self.camera_control()
            elif choice == "6":
                self.auto_mission()
            elif choice == "7":
                print("[시스템 종료] 프로그램을 종료합니다.")
                break
            else:
                print("[ERROR] 잘못된 선택입니다. 다시 시도해주세요.")
            
            time.sleep(1)

# 메인 실행
if __name__ == "__main__":
    simulator = DroneControlSimulation()
    simulator.run()
```

### **1.3 첫 번째 과제: 드론 기능 확장하기**

```python
# assignment_1.py
"""
첫 번째 과제: VirtualDrone 클래스 확장

다음 기능들을 추가하세요:
1. 배터리 경고 시스템 (20% 이하시 경고)
2. 비행 제한 영역 설정 및 검사
3. 비행 로그 기록 시스템
4. RTH(Return to Home) 기능

요구사항:
- 새로운 메서드 추가
- 예외 상황 처리
- 로그 파일 생성

```python 
class EnhancedVirtualDrone(VirtualDrone):
    def __init__(self, drone_id="DRONE_001", home_position=(0, 0, 0)):
        super().__init__(drone_id)
        self.home_position = home_position
        self.flight_log = []
        self.no_fly_zones = []  # 비행 금지 구역 리스트
        
    def check_battery(self):
        """배터리 상태 확인"""
        if self.battery < 20:
            print(f"[WARNING] 배터리 부족: {self.battery}%")
            if self.battery < 10:
                print("[CRITICAL] 즉시 착륙이 필요합니다!")
                return False
        return True
    
    def add_no_fly_zone(self, x1, y1, x2, y2, max_altitude):
        """비행 금지 구역 추가"""
        zone = {
            "x1": min(x1, x2),
            "y1": min(y1, y2),
            "x2": max(x1, x2),
            "y2": max(y1, y2),
            "max_altitude": max_altitude
        }
        self.no_fly_zones.append(zone)
        print(f"[SYSTEM] 비행 금지 구역 추가: {zone}")
    
    def check_no_fly_zone(self, x, y, z):
        """비행 금지 구역 확인"""
        for zone in self.no_fly_zones:
            if (zone["x1"] <= x <= zone["x2"] and 
                zone["y1"] <= y <= zone["y2"] and 
                z <= zone["max_altitude"]):
                return False, zone
        return True, None
    
    # TODO: RTH 기능 구현
    # TODO: 비행 로깅 시스템 구현
    # TODO: 이동 시 비행 금지 구역 검사 추가
```

## **학습 진행 방법**

### 1차시: 기본 개념 이해
- 드론 시스템 아키텍처 설명
- 가상 드론 클래스 구조 이해
- 기본적인 제어 명령 학습

### 2차시: 실습 진행
- 제공된 코드 실행 및 테스트
- 각 메서드의 동작 이해
- 간단한 비행 시나리오 실행

### 3차시: 과제 수행
- EnhancedVirtualDrone 클래스 완성
- 추가 기능 구현
- 테스트 시나리오 작성

## **준비사항**
- Python 3.7 이상 설치
- 코드 편집기 (VSCode, PyCharm 등)
- (선택) matplotlib - 시각화를 원할 경우

이 첫 번째 단계는 실제 드론 없이도 드론 시스템의 기본 개념과 제어 로직을 이해할 수 있도록 설계되었습니다. 
다음 단계에서는 네트워크 통신, 영상 처리, 다중 드론 제어 등으로 확장할 수 있습니다.
