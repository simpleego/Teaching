# 리액트 버전 자판기
> 기존의 바닐라 JavaScript 코드를 **React**로 변환할 수 있습니다.
> React를 사용하면 컴포넌트 기반으로 코드를 구조화하여 **재사용성**과 **유지보수성**을 획기적으로 높일 수 있습니다.

상태(State)가 변경될 때마다 UI가 자동으로 업데이트되므로, 직접 DOM을 조작하는 코드(`document.querySelector`, `.innerHTML` 등)가 사라져 훨씬 더 깔끔하고 예측 가능한 코드를 작성할 수 있습니다.

-----

### React 프로젝트 구조

일반적으로 `create-react-app`이나 `Vite`로 React 프로젝트를 생성한 후, `src` 폴더 안에 다음과 같이 컴포넌트 파일을 구성합니다.

```
/src
├── /components
│   ├── AdminPanel.js         # 관리자 패널 UI 및 로직
│   ├── ControlPanel.js       # 동전 투입, 잔돈 반환 등 제어판
│   ├── OutputArea.js         # 상품/잔돈 배출구
│   └── ProductList.js        # 상품 목록 UI
├── App.css                   # 전역 스타일
└── App.js                    # 메인 애플리케이션 컴포넌트 (상태 관리)
```

-----

### React 코드로 변환

아래 코드를 각 파일에 맞게 복사하여 프로젝트를 구성해 보세요.

#### 1\. `src/App.js` (메인 컴포넌트)

애플리케이션의 모든 \*\*상태(State)\*\*와 **핵심 로직**을 관리하는 최상위 컴포넌트입니다.

```jsx
import React, { useState, useEffect } from 'react';
import ProductList from './components/ProductList';
import ControlPanel from './components/ControlPanel';
import OutputArea from './components/OutputArea';
import AdminPanel from './components/AdminPanel';
import './App.css';

// 기본 상품 데이터
const defaultProducts = [
    { id: 'milk', name: '밀크커피', price: 300, stock: 5, imageSrc: 'img/milkOut.png' },
    { id: 'sugar', name: '설탕커피', price: 500, stock: 5, imageSrc: 'img/sugarOut.png' },
    { id: 'black', name: '블랙커피', price: 200, stock: 5, imageSrc: 'img/blackOut.png' },
    { id: 'canCoffee', name: '캔커피', price: 700, stock: 5, imageSrc: 'img/cancoffee1.png' },
    { id: 'cider', name: '캔사이다', price: 600, stock: 5, imageSrc: 'img/cider1.png' },
    { id: 'cola', name: '캔콜라', price: 650, stock: 5, imageSrc: 'img/cola1.png' }
];

function App() {
    // 1. 상태(State) 관리
    const [products, setProducts] = useState([]);
    const [inMoney, setInMoney] = useState(0);
    const [vmMoney, setVmMoney] = useState(0);
    const [dispensedItem, setDispensedItem] = useState(null);
    const [change, setChange] = useState(0);
    const [isAdminMode, setIsAdminMode] = useState(false);

    // 2. 데이터 로딩 및 저장 (Side Effect 처리)
    useEffect(() => {
        const savedState = localStorage.getItem('vendingMachineState');
        if (savedState) {
            const { products, vmMoney } = JSON.parse(savedState);
            setProducts(products);
            setVmMoney(vmMoney);
        } else {
            setProducts(defaultProducts);
        }
    }, []);

    const saveState = (updatedProducts, updatedVmMoney) => {
        localStorage.setItem('vendingMachineState', JSON.stringify({
            products: updatedProducts,
            vmMoney: updatedVmMoney
        }));
    };

    // 3. 이벤트 핸들러 함수
    const handleInsertCoin = (value) => {
        setInMoney(prev => prev + value);
        setChange(0); // 동전 투입 시 반환금 초기화
    };

    const handlePurchase = (productId) => {
        const product = products.find(p => p.id === productId);
        if (!product || inMoney < product.price || product.stock <= 0) {
            alert('금액이 부족하거나 재고가 없습니다.');
            return;
        }

        const newInMoney = inMoney - product.price;
        const newVmMoney = vmMoney + product.price;
        const updatedProducts = products.map(p =>
            p.id === productId ? { ...p, stock: p.stock - 1 } : p
        );

        setInMoney(newInMoney);
        setVmMoney(newVmMoney);
        setProducts(updatedProducts);
        setDispensedItem(product);
        saveState(updatedProducts, newVmMoney);
    };

    const handleReturnChange = () => {
        setChange(inMoney);
        setInMoney(0);
    };

    const handleTakeOut = () => {
        setDispensedItem(null);
    };

    const handleSaveProducts = (updatedProducts) => {
        setProducts(updatedProducts);
        saveState(updatedProducts, vmMoney);
    };

    return (
        <div id="container">
            <ProductList products={products} inMoney={inMoney} onPurchase={handlePurchase} />
            
            <ControlPanel inMoney={inMoney} onInsertCoin={handleInsertCoin} onReturnChange={handleReturnChange} />
            
            <div id="sales-info">
                <h2>총 판매금액: <span>{vmMoney}</span> 원</h2>
            </div>
            
            <OutputArea item={dispensedItem} change={change} onTakeOut={handleTakeOut} />
            
            <button id="admin-toggle" onClick={() => setIsAdminMode(!isAdminMode)}>
                {isAdminMode ? '관리자 모드 닫기' : '관리자 모드'}
            </button>
            
            {isAdminMode && <AdminPanel products={products} onSave={handleSaveProducts} />}
        </div>
    );
}

export default App;
```

#### 2\. `src/components/ProductList.js`

상품 목록을 표시하는 컴포넌트입니다. `props`로 데이터와 함수를 전달받아 사용합니다.

```jsx
import React from 'react';

function ProductItem({ product, inMoney, onPurchase }) {
    const isAvailable = inMoney >= product.price && product.stock > 0;

    return (
        <li className="product-item">
            <img src={product.imageSrc} alt={product.name} />
            <p>{product.name} ({product.stock}개)</p>
            <p>가격: <span>{product.price}</span>원</p>
            <button 
                onClick={() => onPurchase(product.id)} 
                disabled={!isAvailable}
            >
                {product.name}
            </button>
        </li>
    );
}

function ProductList({ products, inMoney, onPurchase }) {
    return (
        <ul className="products-list">
            {products.map(product => (
                <ProductItem 
                    key={product.id} 
                    product={product} 
                    inMoney={inMoney} 
                    onPurchase={onPurchase} 
                />
            ))}
        </ul>
    );
}

export default ProductList;
```

#### 3\. `src/components/ControlPanel.js`

동전 투입과 잔돈 반환 버튼을 담당하는 컴포넌트입니다.

```jsx
import React from 'react';

function ControlPanel({ inMoney, onInsertCoin, onReturnChange }) {
    return (
        <div id="controls">
            <button onClick={() => onInsertCoin(50)}>50원</button>
            <button onClick={() => onInsertCoin(100)}>100원</button>
            <button onClick={() => onInsertCoin(500)}>500원</button>
            <span>투입 금액: <input size="5" type="text" readOnly value={inMoney} /> 원</span>
            <button onClick={onReturnChange}>잔돈 반환</button>
        </div>
    );
}

export default ControlPanel;
```

#### 4\. `src/components/OutputArea.js`

구매한 상품과 반환된 잔돈을 보여주는 컴포넌트입니다.

```jsx
import React from 'react';

function OutputArea({ item, change, onTakeOut }) {
    return (
        <div id="output-area">
            <div id="coffeeOutBox">
                {item ? (
                    <>
                        <img src={item.imageSrc} alt={item.name} />
                        <button onClick={onTakeOut}>꺼내기</button>
                    </>
                ) : (
                    <p>상품 나오는 곳</p>
                )}
            </div>
            <div id="coinOutBox">
                <p><strong>반환구</strong></p>
                {change > 0 && <p>{change} 원이 반환되었습니다.</p>}
            </div>
        </div>
    );
}

export default OutputArea;
```

#### 5\. `src/components/AdminPanel.js`

상품을 추가, 수정, 삭제하는 관리자 패널 컴포넌트입니다. 자체적으로 폼 입력을 위한 상태를 가집니다.

```jsx
import React, { useState, useEffect } from 'react';

const emptyFormState = { id: null, name: '', price: '', stock: '', imageSrc: '' };

function AdminPanel({ products, onSave }) {
    const [localProducts, setLocalProducts] = useState(products);
    const [formState, setFormState] = useState(emptyFormState);

    // 부모 컴포넌트의 products가 바뀔 때 localProducts도 업데이트
    useEffect(() => {
        setLocalProducts(products);
    }, [products]);

    const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormState(prev => ({ ...prev, [name]: value }));
    };

    const handleSubmit = (e) => {
        e.preventDefault();
        const { id, name, price, stock, imageSrc } = formState;
        if (!name || !price || !stock || !imageSrc) {
            alert('모든 필드를 입력해주세요.');
            return;
        }

        let updatedProducts;
        if (id) { // 수정
            updatedProducts = localProducts.map(p => p.id === id ? { ...formState, price: +price, stock: +stock } : p);
        } else { // 추가
            const newProduct = { ...formState, id: 'prod_' + Date.now(), price: +price, stock: +stock };
            updatedProducts = [...localProducts, newProduct];
        }
        setLocalProducts(updatedProducts);
        onSave(updatedProducts); // 부모(App) 상태 업데이트
        setFormState(emptyFormState); // 폼 초기화
    };
    
    const handleEdit = (product) => {
        setFormState(product);
    };

    const handleDelete = (productId) => {
        if (window.confirm('정말로 이 상품을 삭제하시겠습니까?')) {
            const updatedProducts = localProducts.filter(p => p.id !== productId);
            setLocalProducts(updatedProducts);
            onSave(updatedProducts); // 부모(App) 상태 업데이트
        }
    };

    return (
        <div id="admin-panel">
            <h3>상품 관리</h3>
            <form id="product-form" onSubmit={handleSubmit}>
                <input type="hidden" name="id" value={formState.id || ''} />
                <input type="text" name="name" placeholder="상품명" value={formState.name} onChange={handleInputChange} required />
                <input type="number" name="price" placeholder="가격" value={formState.price} onChange={handleInputChange} required />
                <input type="number" name="stock" placeholder="재고" value={formState.stock} onChange={handleInputChange} required />
                <input type="text" name="imageSrc" placeholder="이미지 경로" value={formState.imageSrc} onChange={handleInputChange} required />
                <button type="submit">저장</button>
                <button type="button" onClick={() => setFormState(emptyFormState)}>초기화</button>
            </form>
            <div id="admin-product-list">
                {localProducts.map(p => (
                    <div className="admin-item" key={p.id}>
                        <span>{p.name} / {p.price}원 / {p.stock}개</span>
                        <div>
                            <button onClick={() => handleEdit(p)}>수정</button>
                            <button onClick={() => handleDelete(p.id)}>삭제</button>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
}

export default AdminPanel;
```

#### 6\. `src/App.css` (스타일)

기존 CSS 코드를 React 환경에 맞게 약간 수정하여 그대로 사용할 수 있습니다. `className`으로 셀렉터를 사용합니다.

```css
body { font-family: sans-serif; }
#container { width: 800px; margin: 20px auto; border: 10px solid #eee; padding: 1em; }
ul { list-style-type: none; padding: 0; margin: 0; }
.products-list { display: flex; flex-wrap: wrap; gap: 1em; }
.product-item { width: 120px; border: 1px solid #953939; background-color: #f5dede; padding: 10px; border-radius: 20px; text-align: center; }
.product-item img { width: 80px; height: 120px; object-fit: cover; }
.product-item p { margin: 5px 0; font-size: 14px; }
.product-item button { width: 100%; padding: 5px; border-radius: 5px; border: 1px solid #ccc; cursor: pointer; }
.product-item button:disabled { background-color: #e0e0e0; cursor: not-allowed; }
#controls, #sales-info, #output-area { margin-top: 20px; padding: 10px; border-radius: 10px; background-color: #f9f9f9; }
#output-area { position: relative; border: 5px solid #953939; display: flex; justify-content: space-between; align-items: flex-end; min-height: 250px; }
#coffeeOutBox, #coinOutBox { border: 10px solid #953939; background-color: #56535370; padding: 10px; border-radius: 20px; min-height: 200px; text-align: center; color: white; }
#coffeeOutBox { width: 120px; }
#coffeeOutBox img { width: 80px; height: 150px; }
#coinOutBox { width: 200px; }
#admin-toggle { margin-top: 20px; padding: 10px; cursor: pointer; }
#admin-panel { margin-top: 20px; padding: 15px; border: 2px dashed #953939; border-radius: 10px; }
#admin-panel h3 { margin-top: 0; }
#product-form { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
#product-form input { padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
#admin-product-list .admin-item { display: flex; justify-content: space-between; align-items: center; padding: 5px; border-bottom: 1px solid #eee; }
#admin-product-list .admin-item button { margin-left: 5px; }
```
