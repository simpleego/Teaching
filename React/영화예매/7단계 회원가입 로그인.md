#  7단계 회원가입 로그인
> **사용자 인증 기능**, 즉 **회원가입과 로그인 기능**을 구현해 보겠습니다.

이번 단계에서는 보안적으로 완벽한 시스템보다는 **인증 흐름의 핵심 개념**을 이해하는 데 초점을 맞추겠습니다. 실제 운영 환경에서는 비밀번호 암호화(bcrypt), JWT (JSON Web Token) 토큰 발급, 데이터베이스 연동 등 훨씬 더 복잡한 과정이 필요하지만, 여기서는 기본적인 원리를 학습하기 위해 간단한 형태로 구현하겠습니다.

이번에도 **[1부] 백엔드(Node.js)** 와 **[2부] 프론트엔드(React)** 로 나누어 진행합니다.

-----

### **[1부] ⚙️ Node.js 백엔드 확장**

기존 `movie-api-server`에 회원가입과 로그인을 처리하는 API 엔드포인트를 추가합니다.

**1. 사용자 데이터 저장소 생성**

실제로는 데이터베이스를 사용해야 하지만, 여기서는 서버가 실행되는 동안에만 유지되는 **간단한 배열**을 사용자 정보 저장소로 사용하겠습니다.

`movie-api-server` 폴더에 `users.js` 파일을 새로 만듭니다.

#### `movie-api-server/users.js`

```javascript
// 임시 사용자 데이터베이스 역할을 하는 배열
const users = [];

module.exports = users;
```

**2. `server.js`에 인증 API 추가**

`movie-api-server/server.js` 파일을 열고 회원가입과 로그인 API 로직을 추가합니다.

```javascript
const express = require('express');
const cors = require('cors');
const movies = require('./movies');
const users = require('./users'); // 사용자 데이터 가져오기

const app = express();
const port = 5000;

app.use(cors());
app.use(express.json()); // POST 요청의 body(JSON)를 파싱하기 위해 추가

// --- 기존 영화 API ---
app.get('/api/movies', (req, res) => {
  res.json(movies);
});

app.get('/api/movies/:id', (req, res) => {
  const movieId = parseInt(req.params.id, 10);
  const movie = movies.find(m => m.id === movieId);
  if (movie) res.json(movie);
  else res.status(404).send('Movie not found');
});

// --- 새로운 인증 API ---

// API 엔드포인트 3: 회원가입
app.post('/api/signup', (req, res) => {
  const { email, password } = req.body;

  // 간단한 유효성 검사
  if (!email || !password) {
    return res.status(400).json({ message: '이메일과 비밀번호를 모두 입력해주세요.' });
  }

  // 이메일 중복 확인
  const userExists = users.find(user => user.email === email);
  if (userExists) {
    return res.status(409).json({ message: '이미 존재하는 이메일입니다.' });
  }

  // 새 사용자 생성 (id는 간단하게 배열 길이 + 1로 지정)
  const newUser = { id: users.length + 1, email, password };
  users.push(newUser);
  console.log('Current users:', users); // 서버 콘솔에서 확인용

  res.status(201).json({ message: '회원가입 성공!', user: newUser });
});

// API 엔드포인트 4: 로그인
app.post('/api/login', (req, res) => {
  const { email, password } = req.body;

  // 사용자 찾기
  const user = users.find(u => u.email === email && u.password === password);

  if (user) {
    // 실제로는 여기에 JWT 토큰을 생성해서 보내줘야 합니다.
    // 지금은 간단하게 사용자 정보와 성공 메시지를 보냅니다.
    res.json({ message: '로그인 성공!', user: { id: user.id, email: user.email } });
  } else {
    res.status(401).json({ message: '이메일 또는 비밀번호가 일치하지 않습니다.' });
  }
});


app.listen(port, () => {
  console.log(`Movie API server listening at http://localhost:${port}`);
});
```

**3. 백엔드 서버 재시작**

코드를 수정했으므로, 실행 중이던 Node.js 서버를 `Ctrl + C`로 중지한 뒤 다시 시작하여 변경사항을 적용합니다.

```bash
node server.js
```

-----

### **[2부] 🖥️ 리액트 프론트엔드 구현**

이제 사용자가 회원가입하고 로그인할 수 있는 페이지와 폼을 만듭니다.

**1. 인증 관련 페이지 컴포넌트 생성**

`src/pages` 폴더에 `Signup.js`와 `Login.js` 파일을 생성합니다.

#### `src/pages/Signup.js`

```javascript
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import './AuthForm.css';

const Signup = () => {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const navigate = useNavigate();

    const handleSubmit = async (e) => {
        e.preventDefault();
        try {
            const response = await fetch('http://localhost:5000/api/signup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password }),
            });
            const data = await response.json();
            if (response.ok) {
                alert(data.message); // "회원가입 성공!"
                navigate('/login'); // 로그인 페이지로 이동
            } else {
                alert(data.message); // "이미 존재하는 이메일입니다." 등
            }
        } catch (error) {
            console.error('Signup error:', error);
            alert('회원가입 중 오류가 발생했습니다.');
        }
    };

    return (
        <div className="auth-container">
            <form className="auth-form" onSubmit={handleSubmit}>
                <h2>회원가입</h2>
                <input
                    type="email"
                    placeholder="이메일"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    required
                />
                <input
                    type="password"
                    placeholder="비밀번호"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    required
                />
                <button type="submit">가입하기</button>
            </form>
        </div>
    );
};

export default Signup;
```

#### `src/pages/Login.js`

```javascript
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import './AuthForm.css';

const Login = () => {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const navigate = useNavigate();

    const handleSubmit = async (e) => {
        e.preventDefault();
        try {
            const response = await fetch('http://localhost:5000/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password }),
            });
            const data = await response.json();
            if (response.ok) {
                alert(data.message); // "로그인 성공!"
                // 로그인 성공 시, 사용자 정보를 localStorage에 저장 (간단한 방식)
                localStorage.setItem('user', JSON.stringify(data.user));
                navigate('/'); // 메인 페이지로 이동
                window.location.reload(); // 헤더 UI 업데이트를 위해 페이지 새로고침
            } else {
                alert(data.message); // "이메일 또는 비밀번호가..."
            }
        } catch (error) {
            console.error('Login error:', error);
            alert('로그인 중 오류가 발생했습니다.');
        }
    };

    return (
        <div className="auth-container">
            <form className="auth-form" onSubmit={handleSubmit}>
                <h2>로그인</h2>
                <input
                    type="email"
                    placeholder="이메일"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    required
                />
                <input
                    type="password"
                    placeholder="비밀번호"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    required
                />
                <button type="submit">로그인</button>
            </form>
        </div>
    );
};

export default Login;
```

**2. 인증 폼 스타일 추가**

`src/pages` 폴더에 `AuthForm.css` 파일을 만들고 공통 스타일을 추가합니다.

#### `src/pages/AuthForm.css`

```css
.auth-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 50px;
}

.auth-form {
    display: flex;
    flex-direction: column;
    width: 350px;
    padding: 30px;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.auth-form h2 {
    margin-bottom: 20px;
    text-align: center;
}

.auth-form input {
    padding: 12px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 1rem;
}

.auth-form button {
    padding: 12px;
    border: none;
    background-color: #333;
    color: white;
    font-size: 1.1rem;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.auth-form button:hover {
    background-color: #555;
}
```

**3. 라우팅 설정 추가 (`App.js`)**

`src/App.js` 파일에 새로 만든 `Signup`과 `Login` 페이지로 이동할 수 있도록 라우트를 추가합니다.

```javascript
// ... 다른 import 구문들
import Signup from './pages/Signup'; // Signup 컴포넌트 import
import Login from './pages/Login';   // Login 컴포넌트 import

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Home />} />
          <Route path="movies" element={<Movies />} />
          <Route path="movies/:movieId" element={<MovieDetail />} />
          <Route path="reserve" element={<Reserve />} />
          <Route path="signup" element={<Signup />} /> {/* 회원가입 경로 추가 */}
          <Route path="login" element={<Login />} />   {/* 로그인 경로 추가 */}
        </Route>
        
        <Route path="*" element={<NotFound />} />
      </Routes>
    </BrowserRouter>
  );
}

export default App;
```

**4. 헤더(Header) UI 변경**

사용자의 로그인 상태에 따라 헤더 메뉴를 동적으로 변경합니다. (로그인/회원가입 또는 로그아웃)

`src/components/Header/Header.js` 파일을 수정합니다.

```javascript
import React from 'react';
import { Link, useNavigate } from 'react-router-dom';
import './Header.css';

const Header = () => {
  const navigate = useNavigate();
  // localStorage에서 사용자 정보를 가져옵니다. 없으면 null.
  const user = JSON.parse(localStorage.getItem('user'));

  const handleLogout = () => {
    localStorage.removeItem('user'); // 사용자 정보 삭제
    navigate('/'); // 홈으로 이동
    window.location.reload(); // 새로고침
  };

  return (
    <header className="header">
      <div className="logo">
        <Link to="/">영화 예매 사이트</Link>
      </div>
      <nav className="nav">
        <ul>
          <li><Link to="/movies">영화</Link></li>
          <li><Link to="/reserve">예매</Link></li>
          {user ? (
            // 로그인된 상태일 때
            <>
              <li><span>{user.email}님</span></li>
              <li><button onClick={handleLogout} className="logout-button">로그아웃</button></li>
            </>
          ) : (
            // 로그아웃된 상태일 때
            <>
              <li><Link to="/login">로그인</Link></li>
              <li><Link to="/signup">회원가입</Link></li>
            </>
          )}
        </ul>
      </nav>
    </header>
  );
};

export default Header;
```

로그아웃 버튼에 대한 간단한 스타일을 `src/components/Header/Header.css` 파일에 추가합니다.

```css
/* Header.css 파일 맨 아래에 추가 */
.logout-button {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  font-size: 1rem;
  font-family: inherit;
}

.logout-button:hover {
  color: #ddd;
}

.nav span {
  color: #a0a0a0; /* 사용자 이메일 스타일 */
}
```

-----

### **[3부] ✅ 실행 및 확인**

1.  **백엔드 서버**와 **리액트 개발 서버**가 모두 실행 중인지 확인합니다.
2.  브라우저에서 `http://localhost:3000`으로 접속합니다.
3.  헤더 우측에 '**로그인**'과 '**회원가입**' 메뉴가 보입니다.
4.  **회원가입**을 클릭하고 이메일과 비밀번호를 입력하여 가입합니다. 성공하면 로그인 페이지로 이동합니다.
5.  방금 가입한 정보로 **로그인**합니다. 성공하면 메인 페이지로 이동합니다.
6.  이제 헤더 우측에 **사용자 이메일**과 '**로그아웃**' 버튼이 보입니다.
7.  **로그아웃** 버튼을 클릭하면 다시 초기 상태로 돌아갑니다.

이것으로 기본적인 사용자 인증 기능 구현이 완료되었습니다\! 👏

**참고:** `localStorage`를 사용하고 페이지를 새로고침하는 방식은 가장 간단한 구현 예시입니다. 실제 애플리케이션에서는 \*\*전역 상태 관리(Context API, Redux 등)\*\*를 통해 로그인 상태를 관리하여, 페이지 새로고침 없이도 모든 컴포넌트가 로그인 상태 변경을 즉시 인지하도록 만드는 것이 일반적입니다.
