# 네이버얼굴인식  
> 자바스크립트를 이용해 CLOVA 얼굴 인식(CFR) API를 호출할 수 있습니다.
> **매우 중요한 보안 사항**이 있습니다.

API 호출에 필요한 인증 키(`Client ID`, `Client Secret`)는 절대 브라우저(프론트엔드) 코드에 노출되어서는 안 됩니다. 만약 노출되면 누구나 내 키를 가져다 무단으로 사용할 수 있습니다.

따라서 가장 안전하고 올바른 방법은 **사용자의 브라우저(클라이언트)가 직접 네이버 API를 호출하는 것이 아니라, 여러분이 만든 백엔드 서버에 요청을 보내고, 그 서버가 네이버 API를 대신 호출한 후 결과를 다시 브라우저로 전달**하는 방식입니다.

아래 예제는 이 안전한 구조를 기반으로 \*\*프론트엔드(HTML/JS)\*\*와 **백엔드(Node.js)** 코드를 함께 보여줍니다.

-----

### \#\# 🔒 안전한 호출 방식: 클라이언트 ↔ 서버 ↔ 네이버 API

1.  **클라이언트 (🖼️ 브라우저)**: 사용자가 이미지를 선택하고 '얼굴 분석' 버튼을 누릅니다.
2.  **클라이언트 → 서버**: 브라우저는 이미지를 **우리의 백엔드 서버**로 전송합니다.
3.  **서버 (🖥️ Node.js)**: 백엔드 서버가 이미지를 받습니다.
4.  **서버 → 네이버 API (☁️ CLOVA)**: 백엔드 서버는 **숨겨둔 API 키**를 사용하여 네이버 CLOVA 얼굴 인식 API로 이미지를 전달하고 분석을 요청합니다.
5.  **네이버 API → 서버**: 네이버 API가 분석 결과를 백엔드 서버로 보내줍니다.
6.  **서버 → 클라이언트**: 백엔드 서버는 받은 결과를 다시 브라우저로 전달합니다.
7.  **클라이언트**: 브라우저는 최종 결과를 화면에 표시합니다.

-----

### \#\# 📝 예제 코드

이 예제를 실행하려면 Node.js가 설치되어 있어야 합니다.

#### **1. 백엔드 준비 (Node.js & Express)**

먼저 프로젝트 폴더를 만들고 필요한 라이브러리를 설치합니다.

```bash
mkdir clova-face-api-example
cd clova-face-api-example
npm init -y
npm install express multer node-fetch
```

  - **express**: 웹 서버를 만들기 위한 프레임워크
  - **multer**: 이미지 파일 업로드를 쉽게 처리하기 위한 라이브러리
  - **node-fetch**: Node.js 환경에서 fetch API를 사용하기 위한 라이브러리

이제 `server.js` 파일을 생성하고 아래 코드를 작성하세요.

**`server.js` (백엔드 서버)**

```javascript
const express = require('express');
const multer = require('multer');
const fetch = require('node-fetch');
const FormData = require('form-data');
const fs = require('fs');

const app = express();
const upload = multer({ storage: multer.memoryStorage() }); // 파일을 메모리에 저장

// 중요! 실제 서비스에서는 환경 변수(process.env) 등을 사용해 키를 안전하게 관리해야 합니다.
const CLIENT_ID = 'YOUR_CLIENT_ID';       // 네이버 클라우드 플랫폼에서 발급받은 Client ID
const CLIENT_SECRET = 'YOUR_CLIENT_SECRET'; // 네이버 클라우드 플랫폼에서 발급받은 Client Secret

// 프론트엔드 HTML 파일을 서비스하기 위한 설정
app.use(express.static('public'));

// 얼굴 분석 API를 호출하는 엔드포인트
app.post('/api/detect-face', upload.single('image'), async (req, res) => {
  if (!req.file) {
    return res.status(400).json({ error: '이미지 파일이 필요합니다.' });
  }

  try {
    const api_url = 'https://naveropenapi.apigw.ntruss.com/vision/v1/face';
    
    // 네이버 API로 보낼 FormData 생성
    const formData = new FormData();
    formData.append('image', req.file.buffer, { filename: 'image.jpg', contentType: req.file.mimetype });

    const response = await fetch(api_url, {
      method: 'POST',
      headers: {
        'X-NCP-APIGW-API-KEY-ID': CLIENT_ID,
        'X-NCP-APIGW-API-KEY': CLIENT_SECRET,
        ...formData.getHeaders()
      },
      body: formData,
    });

    const data = await response.json();
    res.json(data);

  } catch (error) {
    console.error('API 호출 중 오류 발생:', error);
    res.status(500).json({ error: '서버에서 오류가 발생했습니다.' });
  }
});

const PORT = 3000;
app.listen(PORT, () => {
  console.log(`서버가 http://localhost:${PORT} 에서 실행 중입니다.`);
});
```

#### **2. 프론트엔드 준비 (HTML & JavaScript)**

`clova-face-api-example` 폴더 안에 `public` 폴더를 만들고, 그 안에 `index.html` 파일을 생성하세요.

**`public/index.html` (프론트엔드)**

```html
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>CLOVA 얼굴 인식 API 예제</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #results { margin-top: 20px; white-space: pre-wrap; background-color: #f4f4f4; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>CLOVA 얼굴 인식(CFR) JavaScript 예제</h1>
  <p>분석할 얼굴 이미지를 선택하세요.</p>
  <input type="file" id="imageInput" accept="image/*">
  <button id="submitBtn">얼굴 분석하기</button>

  <h2>분석 결과:</h2>
  <div id="results">결과가 여기에 표시됩니다.</div>

  <script>
    document.getElementById('submitBtn').addEventListener('click', async () => {
      const imageInput = document.getElementById('imageInput');
      const resultsDiv = document.getElementById('results');
      
      if (imageInput.files.length === 0) {
        alert('이미지를 선택해주세요.');
        return;
      }

      resultsDiv.textContent = '분석 중...';

      const formData = new FormData();
      formData.append('image', imageInput.files[0]);

      try {
        // 백엔드 서버의 API 엔드포인트로 요청을 보냅니다.
        const response = await fetch('/api/detect-face', {
          method: 'POST',
          body: formData,
        });

        const data = await response.json();

        // 결과를 예쁘게 포맷팅하여 표시합니다.
        resultsDiv.textContent = JSON.stringify(data, null, 2);

      } catch (error) {
        console.error('오류 발생:', error);
        resultsDiv.textContent = '오류가 발생했습니다. 자세한 내용은 콘솔을 확인하세요.';
      }
    });
  </script>
</body>
</html>
```

-----

### \#\# 🚀 실행 방법

1.  **API 키 발급**: 네이버 클라우드 플랫폼에서 **AI·NAVER API**를 신청하고 **Application 등록** 후 `Client ID`와 `Client Secret`을 발급받으세요.
2.  **키 입력**: `server.js` 파일의 `YOUR_CLIENT_ID`와 `YOUR_CLIENT_SECRET` 부분을 발급받은 키로 교체하세요.
3.  **서버 실행**: 터미널에서 아래 명령어를 입력하여 백엔드 서버를 실행합니다.
    ```bash
    node server.js
    ```
4.  **확인**: 웹 브라우저를 열고 `http://localhost:3000` 주소로 접속합니다.
5.  이미지 파일을 선택하고 '얼굴 분석하기' 버튼을 누르면 분석 결과가 JSON 형태로 화면에 나타납니다.
