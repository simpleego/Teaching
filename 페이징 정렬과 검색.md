# 페이징 정렬과 검색
> 이제 도서 검색 결과에 **페이지 네비게이션 바**와 함께 **정렬 기능**까지 추가해볼게요.
> 사용자가 원하는 기준(예: 도서명, 출판년도, 가격 등)으로 정렬할 수 있도록 구현하겠습니다.

---

## 🔧 Controller 수정 (`BookController.java`)

```java
@GetMapping("/search")
public String searchBooks(@RequestParam(required = false) String publisher,
                          @RequestParam(required = false) Integer year,
                          @RequestParam(defaultValue = "1") int page,
                          @RequestParam(defaultValue = "bookname") String sort,
                          Model model) {

    int size = 5;
    List<Book> books = bookService.searchBooks(publisher, year, page, size, sort);
    int total = bookService.countBooks(publisher, year);
    int totalPages = (int) Math.ceil((double) total / size);

    model.addAttribute("books", books);
    model.addAttribute("currentPage", page);
    model.addAttribute("totalPages", totalPages);
    model.addAttribute("publisher", publisher);
    model.addAttribute("year", year);
    model.addAttribute("sort", sort);

    return "search";
}
```

---

## 🧠 Service 수정 (`BookService.java`)

```java
public List<Book> searchBooks(String publisher, Integer year, int page, int size, String sort) {
    int offset = (page - 1) * size;
    return bookMapper.searchBooks(publisher, year, offset, size, sort);
}
```

---

## 🗂️ Mapper 인터페이스 수정 (`BookMapper.java`)

```java
List<Book> searchBooks(@Param("publisher") String publisher,
                       @Param("year") Integer year,
                       @Param("offset") int offset,
                       @Param("limit") int limit,
                       @Param("sort") String sort);
```

---

## 📄 Mapper XML 수정 (`BookMapper.xml`)

```xml
<select id="searchBooks" resultType="Book">
    SELECT * FROM Book
    WHERE
        (publisher LIKE CONCAT('%', #{publisher}, '%') OR #{publisher} IS NULL)
        AND (year = #{year} OR #{year} IS NULL)
    ORDER BY
        <choose>
            <when test="sort == 'bookname'">bookname</when>
            <when test="sort == 'year'">year</when>
            <when test="sort == 'price'">price</when>
            <otherwise>bookid</otherwise>
        </choose>
    LIMIT #{limit} OFFSET #{offset}
</select>
```

---

## 🎨 Thymeleaf 템플릿 수정 (`search.html`)

### 🔍 검색 및 정렬 폼

```html
<form method="get" th:action="@{/search}">
    <input type="text" name="publisher" placeholder="출판사" th:value="${publisher}">
    <input type="number" name="year" placeholder="출판년도" th:value="${year}">
    
    <select name="sort">
        <option value="bookname" th:selected="${sort == 'bookname'}">도서명</option>
        <option value="year" th:selected="${sort == 'year'}">출판년도</option>
        <option value="price" th:selected="${sort == 'price'}">가격</option>
    </select>

    <button type="submit">검색</button>
</form>
```

### 📌 페이지 네비게이션 바

```html
<div>
    <a th:href="@{/search(publisher=${publisher}, year=${year}, sort=${sort}, page=1)}">
        <button>⏮ 첫 페이지</button>
    </a>

    <span th:each="i : ${#numbers.sequence(1, totalPages)}">
        <a th:href="@{/search(publisher=${publisher}, year=${year}, sort=${sort}, page=${i})}">
            <button th:classappend="${i == currentPage} ? 'active' : ''">[[${i}]]</button>
        </a>
    </span>

    <a th:href="@{/search(publisher=${publisher}, year=${year}, sort=${sort}, page=${totalPages})}">
        <button>⏭ 마지막 페이지</button>
    </a>
</div>
```

---

## 💅 스타일 팁 (선택사항)

```html
<style>
    button.active {
        background-color: #007bff;
        color: white;
        font-weight: bold;
    }
</style>
```

---

이제 사용자는 원하는 정렬 기준으로 검색 결과를 볼 수 있고, 페이지 번호를 클릭해 빠르게 이동할 수 있어요! 다음으로는 검색 결과 하이라이트나 필터링 기능도 추가해볼 수 있어요. 어떤 기능이 더 있으면 좋겠어요 jong? 😄
